<!DOCTYPE html> 
<html>
<head>
<meta charset="UTF-8">
<title>jQuery Mobile Web App</title>
<link href="jquery-mobile/jquery.mobile.theme-1.3.0.min.css" rel="stylesheet" type="text/css"/>
<link href="jquery-mobile/jquery.mobile.structure-1.3.0.min.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.3.0.min.js" type="text/javascript"></script>

 <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="ratchet.css">
    <link rel="stylesheet" href="styles.css">




</head> 
<body onload="getInfo()" onLoad="onDeviceReady()"> 
<div data-role="page" id="hungry" data-add-back-btn="true"  data-back-btn-theme="b">
	<div class="ui-bar-b" data-role="header" >
		<h1>People Nearby</h1>
       
	</div>
	<div data-role="listview">	
    	<li><a href="#zz">
		<table width=90% border=1%>
  <tr>
    <td width=20% height="80"><img id="img11" width="80" height="80" alt=""/></td>
    <td width=80% style="text-align: justify">
     <table width=180 height="60" border="0">
      <tr>
        <td width=30% height="30"><div id="friend1name"></div>&nbsp;&nbsp;</td>
	
   
      </tr>
      <tr>
        <td height="30"><img id="gdr1" width="30" height="26" alt=""/></td>
        <td>&nbsp;</td>
        <td width="30">1.0 m</td>
      </tr>
    </table> 
    </td>
  </tr>
</table>
</a></li>
</div>





	<div data-role="listview">	
    	<li><a href="#mj">
		<table width=90% border=1%>
  <tr>
    <td width=20% height="80"><img id="img21" width="80" height="80" alt=""/></td>
    <td width=80% style="text-align: justify">
     <table width=180 height="60" border="0">
      <tr>
        <td width=30% height="30"><div id="friend2name"></div></td>
   
   
      </tr>
      <tr>
        <td height="30"><img id="gdr2" width="30" height="26" alt=""/></td>
        <td>&nbsp;</td>
        <td width="30">2.3 m</td>
      </tr>
    </table> 
    </td>
  </tr>
</table>
</a></li>
</div>

	<div data-role="listview">	
    	<li><a href="#hl">
		<table width=90% border=1%>
  <tr>
    <td width=20% height="80"><img id="img31" width="80" height="80" alt=""/></td>
    <td width=80% style="text-align: justify">
     <table width=180 height="60" border="0">
      <tr>
        <td width=30% height="30"><div id="friend3name"></div></td>
     
      </tr>
      <tr>
        <td height="30"><img id="gdr3" width="30" height="26" alt=""/></td>
        <td>&nbsp;</td>
        <td width="30">4.1 m</td>
      </tr>
    </table> 
    </td>
  </tr>
</table>
</a></li>
</div>

	<div data-role="footer" class="ui-bar-b" >

<a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
   
	</div>
</div>
<div data-role="page" id="page">
	<div class="ui-bar-b" data-role="header" data-add-back-btn="true" data-back-btn-theme="b">
		<h1>What`s going on</h1>

	</div>
	<div data-role="content">	
		<ul data-role="listview">
			<li>		<table width=90% border="1">
  <tr>
    <td width="53" height="40"><img id="img13" width="40" height="40"/></td>
    <td width=304 style="text-align: justify">
     <table width=100% height="60" border="0">
      <tr>
        <td width=30% height="30"><a href="#zz"><div id="friend1name2"></div></a></td>
        <td width=30% style="font-size: 14px">&nbsp;ate with&nbsp;</td>
        <td width=40%><a href="#hl"><div id="friend3name2"></div></a></td>
   
      </tr>
 
            <tr>
        <td height="30" style="font-size: 14px">30 mins</td>
        <td style="font-size: 14px">&nbsp;</td>
        <td width="143" style="font-size: 14px">At Wendy`s</td>
      </tr>
    </table> 
    </td>
  </tr>
</table></li>

            <li>
            <table width=90% border="1">
  <tr>
    <td width="53" height="40"><img id="img23" width="40" height="40" alt=""/></td>
    <td width=304 style="text-align: justify">
     <table width=100% height="60" border="0">
      <tr>
     <td width=30% height="30">  <a href="#mj"><div id="friend2name2"></div></a></td>
        <td width=30% style="font-size: 14px">wants a </td>
        <td width=40% style="font-size: 14px">lunch budy</td>
   
      </tr>

      <tr>
        <td height="30" style="font-size: 14px">at 12pm </td>
        <td style="font-size: 14px">&nbsp;</td>
        <td width="30" style="font-size: 14px">At Gato</td>
      </tr>
    </table> 
    </td>
  </tr>
</table>
            </li>
			<li><table width=90% border="1">
  <tr>
    <td width="53" height="40"><img id="img33" width="40" height="40" alt=""/></td>
    <td width=304 style="text-align: justify">
     <table width=100% height="60" border="0">
      <tr>
        <td  height="30"><a href="#hl"><div id="friend3name3"></div></a></td>
       
      </tr>
            <tr>
        <td height="30" style="font-size: 14px">Join&nbsp;</td>
                <td width=52 >Never&nbsp;&nbsp;</td>

        <td width="148">Eat Alone</td>
      </tr>
      <tr>
        <td height="30" style="font-size: 14px">2 hrs</td>
                <td width=52 style="font-size: 14px"></td>

        <td width="148">&nbsp;</td>
      </tr>
    </table> 
    </td>
  </tr>
</table></li>
		</ul>		
	</div>
	<div data-role="footer" class="ui-bar-b">
<a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
   

	</div>
</div>


<div data-role="page" id="myprofile" data-add-back-btn="true" data-back-btn-theme="b">
	<div data-role="header" class="ui-bar-b">
  
		<h1>My Profile</h1>
	</div>


<p>&nbsp;&nbsp;&nbsp;&nbsp;<span id="pic"></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;id： <span id="user_id"></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Name: <span id="userName"></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Birthday: <span id="user_birthday"></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Gender: <span id="user_gender"></span></p>
<p id="geolocation">&nbsp;&nbsp;&nbsp;&nbsp;Finding geolocation...</p>


<button type="button" class="btn" onclick="revoke()" style="height:1em"><img src="img/fblogout.png" width="180" height="25" /></button>




<script src="cordova.js"></script>
<script src="openfb.js"></script>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<script>

    openFB.init('774291202603858'); // Defaults to sessionStorage for storing the Facebook token

//  Uncomment the line below to store the Facebook token in localStorage instead of sessionStorage
//  openFB.init('774291202603858', 'http://localhost/openfb/oauthcallback.html', window.localStorage);

    function login() {
        openFB.login('email',
                function() {
                    //alert('Facebook login succeeded');
					  window.location ="./homepage.html";
                },
                function(error) {
                    alert('Facebook login failed: ' + error.error_description);
                });
    }
	

 // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
    }
	var la;
	var lo;
    // onSuccess Geolocation
    //
    function onSuccess(position) {
        var element = document.getElementById('geolocation');
        element.innerHTML = ' &nbsp;&nbsp;&nbsp;&nbsp;Latitude: '           + position.coords.latitude              + '<br />' +
                            ' &nbsp;&nbsp;&nbsp;&nbsp;Longitude: '          + position.coords.longitude             + '<br />' ;
								la=	position.coords.latitude;	
	lo=	position.coords.longitude ;		
    }
	
    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
                'message: ' + error.message + '\n');
    }

    function getInfo() {
        openFB.api({
            path: '/me',
            success: function(data) {
                console.log(JSON.stringify(data));
                document.getElementById("userName").innerHTML = data.name;
				 document.getElementById("user_birthday").innerHTML = data.birthday;
				 document.getElementById("user_id").innerHTML = data.id;
				 document.getElementById("user_gender").innerHTML = data.gender;
				//document.write("<img src =https://graph.facebook.com/'+data.id+'/picture>");
				document.getElementById("pic").innerHTML="<img src=https://graph.facebook.com/"+data.id+"/picture?width=100&height=100>";
			
  $.post("http://websys1.stern.nyu.edu:8000/users/fblogin/",{fb_id:data.id,fb_token:"123",name:data.name,gender:data.gender.toUpperCase(),latitude:la,longitude:lo},function(result){   });
  
  $.get("http://websys1.stern.nyu.edu:8000/users/nearby_list",{fb_id:data.id}, function(nearby){
	//console.log(nearby);
	$("#friend1name").html(nearby['users'][0].name);
	$("#friend1name1").html(nearby['users'][0].name);
	$("#friend1name2").html(nearby['users'][0].name);
	$("#friend1name3").html(nearby['users'][0].name);
	$("#friend1gender").html(nearby['users'][0].gender);
	var id1=nearby['users'][0].fb_id;
	var id2=nearby['users'][1].fb_id;
	var id3=nearby['users'][2].fb_id;
	var gd1=nearby['users'][0].gender;
	var gd2=nearby['users'][1].gender;
	var gd3=nearby['users'][2].gender;
	$("#friend1id").html(nearby['users'][0].fb_id);
    $("#friend2name").html(nearby['users'][1].name);
	$("#friend2name1").html(nearby['users'][1].name);
	$("#friend2name2").html(nearby['users'][1].name);
	$("#friend2gender").html(nearby['users'][1].gender);
	$("#friend2id").html(nearby['users'][1].fb_id);
	$("#friend3name").html(nearby['users'][2].name);
	$("#friend3name1").html(nearby['users'][2].name);
	$("#friend3name2").html(nearby['users'][2].name);
	$("#friend3name3").html(nearby['users'][2].name);
	$("#friend3gender").html(nearby['users'][2].gender);
	$("#friend3id").html(nearby['users'][2].fb_id);
	$("#img11").attr("src","http://graph.facebook.com/"+id1+"/picture?type=square");
	$("#img12").attr("src","http://graph.facebook.com/"+id1+"/picture?type=square");
	$("#img13").attr("src","http://graph.facebook.com/"+id1+"/picture?type=square");
	$("#img21").attr("src","http://graph.facebook.com/"+id2+"/picture?type=square");
	$("#img22").attr("src","http://graph.facebook.com/"+id2+"/picture?type=square");
	$("#img23").attr("src","http://graph.facebook.com/"+id2+"/picture?type=square");	
	$("#img31").attr("src","http://graph.facebook.com/"+id3+"/picture?type=square");
	$("#img32").attr("src","http://graph.facebook.com/"+id3+"/picture?type=square");
	$("#img33").attr("src","http://graph.facebook.com/"+id3+"/picture?type=square");
	$("#gdr1").attr("src",gd1+".png");
	$("#gdr2").attr("src",gd2+".png");
	$("#gdr3").attr("src",gd3+".png");



                          /*  $.each(data['posts'], function(index, value) {
	alert('Permissions revoked');
                           $("#page").append("<a href=" + value['post']['guid'] + ">" +  value['post']['title'] + "</a> ");
                           $("#page").append("<br>");
						   $("#page").append("The post is" +value['post']['title']);
			              }
);
			*/
                             }
				);
  
         },				
            error: errorHandler});
			
			
			
			 
    }







    function share() {
        openFB.api({
            method: 'POST',
            path: '/me/feed',
            params: {
                message: 'Testing Facebook APIs'
            },
            success: function() {
                alert('the item was posted on Facebook');
            },
            error: errorHandler});
    }

    function revoke() {
        openFB.revokePermissions(
                function() {
                    alert('Permissions revoked');
					  window.location ="./index.html"
                },
                errorHandler);
    }

    function errorHandler(error) {
        alert(error.message);
    }
	
	/*window.onload=function(){
			getInfo();
	}*/


</script>





	<div data-role="footer" class="ui-bar-b">
 <a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
</div>
</div>


<div data-role="page" id="zz"  data-add-back-btn="true" data-back-btn-theme="b">
	<div class="ui-bar-b" data-role="header">
		<h1>Profile</h1>
	</div>
	<div data-role="content">
    <table width="200" border="0">
  <tr>
    <td><img id="img12" height="100" width="100" alt=""/></td>
  </tr>
</table>
    <table width="359" border="0">
  <tr>
    <td width="213"><div id="friend1name1"></div></td>
    <td width="136">29 yeas old</td>
  </tr>
  <tr>
    <td>5 Mutual Friends</td>
    <td>1.0 mile</td>
  </tr>
  <tr>
    <td><div id="friend1gender"></div></td>
    <td>&nbsp;</td>
  </tr>
    <tr>
    <td><a href="https://www.facebook.com/509892749">Facebook Link</a></td>
    <td>&nbsp;</td>
  </tr>
</table>
    </div>
 
	<div data-role="footer" class="ui-bar-b">
    <a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
 
	</div>
</div>

<div data-role="page" id="mj" data-add-back-btn="true" data-back-btn-theme="b">
	<div class="ui-bar-b" data-role="header">
		<h1>Profile</h1>
	</div>
	<div data-role="content">
    <table width="200" border="0">
  <tr>
    <td><img id="img22" width="100" height="100" alt=""/></td>
  </tr>
</table>
    <table width="365" border="0">
  <tr>
    <td width="201"><div id="friend2name1"></div></td>
    <td width="154">Secret</td>
  </tr>
  <tr>
    <td>2 Mutual Friends</td>
    <td>1.4 miles</td>
  </tr>
  <tr>
    <td><div id="friend2gender"></div></td>
    <td>&nbsp;</td>
  </tr>
    <tr>
    <td><a href="https://www.facebook.com/46800090">Facebook Link</a></td>
    <td></td>
  </tr>
</table>
    </div>
	 <div data-role="footer" class="ui-bar-b">
    <a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
 
	</div>
</div>

<div data-role="page" id="hl" data-add-back-btn="true" data-back-btn-theme="b">
	<div class="ui-bar-b" data-role="header">
		<h1>Profile</h1>
	</div>
	<div data-role="content">
    <table width="200" border="0">
  <tr>
    <td><img id="img32" width="100" height="100" alt=""/></td>
  </tr>
</table>
    <table width="367" border="0">
  <tr>
    <td width="206"><div id="friend3name1"></div></td>
    <td width="151">23 years old</td>
  </tr>
  <tr>
    <td>2 Mutual Friends</td>
    <td>4.3 miles</td>
  </tr>
  <tr>
    <td><div id="friend3gender"></div></td>
    <td>&nbsp;</td>
  </tr>
    <tr>
    <td><a href="https://www.facebook.com/100001259055613">Facebook Link</a></td>
    <td></td>
  </tr>
</table>
    </div>
	 <div data-role="footer" class="ui-bar-b">
    <a href="#page" data-role="button" style="width:6em; height:2em; " data-icon="home">Activity</a>
        <a href="#hungry" data-role="button" style="width:6em; height:2em;" data-icon="alert">Hungry</a>
        <a href="#myprofile" data-role="button" style="width: 6em; height:2em;" data-icon="info">Profile</a>
 
	</div>
</div>
 

 
 
 
</body>
</html>